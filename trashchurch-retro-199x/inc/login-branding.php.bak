<?php
/**
 * Login screen branding for TrashChurch Retro 199X
 *
 * Replaces the default WP login logo with the site's logo and updates
 * the login logo link and title to point to the site homepage.
 *
 * Uses a root-relative path for the image so the URL is not hard-coded
 * to a specific scheme/host. If you prefer to serve the image from the
 * theme, change the path or filter 'tr199x_login_logo_path'.
 *
 * Place this file in: wp-content/themes/trashchurch-retro-199x/inc/login-branding.php
 * and include it from your functions.php (if you haven't already).
 */

if ( ! defined( 'ABSPATH' ) ) {
	exit;
}

/**
 * Return the login logo path (root-relative by default).
 * Filterable so you can override from child themes or plugins.
 *
 * Example result: '/wp-content/uploads/2025/07/cropped-cropped-logo-tc-icon.png'
 *
 * @return string
 */
function tr199x_get_login_logo_path() {
	$default = '/wp-content/uploads/2025/07/cropped-cropped-logo-tc-icon.png';
	$path = apply_filters( 'tr199x_login_logo_path', $default );
	// Ensure it's a string and trim whitespace
	return is_string( $path ) ? trim( $path ) : $default;
}

/**
 * Output inline CSS on the login screen to use a custom logo image.
 * Uses a root-relative URL so it won't be scheme/host-locked.
 */
function tr199x_login_branding_css() {
	$logo_path = tr199x_get_login_logo_path();
	// Escaping: esc_url() accepts relative URLs as-is.
	$logo_url = esc_url( $logo_path );

	// You can adjust width/height to match your actual logo dimensions.
	$width  = apply_filters( 'tr199x_login_logo_width', 250 );
	$height = apply_filters( 'tr199x_login_logo_height', 250 );
	?>
	<style type="text/css">
		.login h1 a {
			background-image: url('<?php echo $logo_url; ?>') !important;
			background-repeat: no-repeat !important;
			background-position: center center !important;
			background-size: contain !important;
			width: <?php echo intval( $width ); ?>px !important;
			height: <?php echo intval( $height ); ?>px !important;
		}
		/* Optional: reduce default padding around the logo area on small screens */
		@media (max-width: 320px) {
			.login h1 {
				margin-bottom: 10px;
			}
		}
	</style>
	<?php
}
add_action( 'login_enqueue_scripts', 'tr199x_login_branding_css' );

/**
 * Make the login logo link point to the site home instead of wordpress.org
 */
function tr199x_login_logo_url() {
	return home_url();
}
add_filter( 'login_headerurl', 'tr199x_login_logo_url' );

/**
 * Change the title attribute (hover text) on the login logo
 */
function tr199x_login_logo_title() {
	return get_bloginfo( 'name' );
}
add_filter( 'login_headertext', 'tr199x_login_logo_title' );
